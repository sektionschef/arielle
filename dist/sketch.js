const MODE=1,NOISESEED=hashFnv32a(fxhash),HIGHRESPIXELRATIO=4,conv=10;let canvas,rescaling_width,rescaling_height,timingInit,PALETTE,PALETTE_LABEL,APPLESIZELABEL,APPLESIZE=getRandomFromList([1,1.5,2,3]);APPLESIZELABEL=APPLESIZE<2?"small":2==APPLESIZE?"medium":"large";let RESTITUTIONMin=0,RESTITUTIONMax=1,RESTITUTION=Math.round(100*getRandomFromInterval(RESTITUTIONMin,RESTITUTIONMax))/100,RESTITUTIONLabel=label_feature(RESTITUTION,RESTITUTIONMin,RESTITUTIONMax),OBSTACLESSWITCH=getRandomFromList([!0,!1]),OBSTACLESCOUNT=5,LIGHTING=getRandomFromList(["Below","Lab","Drama","Full"]);const WAVECOUNT=3,WAVEINDEXMAX=2;let waveIndex=0,HIGHRES=!1;const PALETTESYSTEM={Arielle:["#534438","#FBE1BB","#785237","#926139"],Ierissos:["#e7d3a4","#ede7d1","#404040","#7d9bb3"],Niko:["#211f1f","#808080","#c0c0c0","#ffffff"],"Fix Hellas":["#A10035","#FEC260","#3FA796","#2A0944"],Parmigiana:["#ffd1a9","#ff9e79","#fb6d4c","#c23b22","#580000"],Mamos:["#77d8f9","#624c38","#cedeed","#c64b62"],Babushka:["#d8bc00","#040c21","#74a2c6","#a43b4f"],Autodrom:["#d8bc00","#894292","#67bfee","#3e2543"],Olivenhain:["\t#14140a","#918e41","#ffc83d","#4e542c"]};function choosePalette(){allPalettes=[];for(let e in PALETTESYSTEM)allPalettes.push(e);PALETTE_LABEL=getRandomFromList(allPalettes),PALETTE=PALETTESYSTEM[PALETTE_LABEL]}function createPaletteColors(){for(let a in PALETTESYSTEM)for(var e=0;e<PALETTESYSTEM[a].length;e++)PALETTESYSTEM[a][e]=color(PALETTESYSTEM[a][e])}function setup(){noiseSeed(NOISESEED),randomSeed(NOISESEED),setAttributes("antialias",!0),scaleDynamically(),canvas=createCanvas(rescaling_width,rescaling_height,WEBGL),canvas.id("badAssCanvas"),createPaletteColors(),addTexture(),world=new OIMO.World({timestep:1/60,iterations:8,broadphase:2,worldscale:1,random:!0,info:!1,gravity:[0,-9.8,3]}),ground=new Body({type:"box",size:[100,10,100],pos:[0,-20,0],rot:[0,0,0],move:!1,density:1e3,friction:.6,restitution:0,name:"ground"},color(0,255,0,100)),lowerBorder=new Body({type:"box",size:[100,50,10],pos:[0,0,55],rot:[0,0,0],move:!1,density:1e3,friction:.2,restitution:.2,name:"lowerBorder"},color(0,155,0,100)),pushers=new PusherSystem(ground.body.shapes.width),timingInit=0}function draw(){HIGHRES&&pixelDensity(4),camera(0,700,0,0,0,0,0,0,1),"Full"==LIGHTING?(ambientLight(150),directionalLight(200,200,200,1,-1,0)):"Drama"==LIGHTING?(ambientLight(50),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30)),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30)),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30)),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30)),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30))):"Below"==LIGHTING?(ambientLight(100),directionalLight(180,180,180,0,-1,0)):"Lab"==LIGHTING&&(ambientLight(100),directionalLight(255,255,255,0,-1,-1)),world.step(),"undefined"!=typeof applesFall&&applesFall.updateDisplay(),"undefined"!=typeof apples&&apples.updateDisplay(),"undefined"!=typeof apples2&&apples2.updateDisplay(),"undefined"!=typeof apples3&&apples3.updateDisplay(),ground.update(),lowerBorder.update(),pushers.updateDisplay(),"undefined"!=typeof obstacles&&obstacles.updateDisplay(),timing(timingInit)}function mousePressed(){}function drawPixelBuffer(e,a,l,t,n){let o=createGraphics(e,a);o.loadPixels();for(let e=0;e<o.height;e++)for(let a=0;a<o.width;a++){let i=4*(a+e*o.width);fxrand()<.02?(o.pixels[i+0]=red(t),o.pixels[i+1]=green(t),o.pixels[i+2]=blue(t)):fxrand()>.98?(o.pixels[i+0]=200,o.pixels[i+1]=200,o.pixels[i+2]=200):(o.pixels[i+0]=random(red(l)-n,red(l)+n),o.pixels[i+1]=random(green(l)-n,green(l)+n),o.pixels[i+2]=random(blue(l)-n,blue(l)+n)),o.pixels[i+3]=255}return o.updatePixels(),o}function addTexture(){for(var e=0;e<PALETTE.length;e++){if(0==e)var a=PALETTE.length-1;else a=e-1;PALETTE[e].img=drawPixelBuffer(Math.round(10*APPLESIZE*4),Math.round(10*APPLESIZE*4),PALETTE[e],PALETTE[a],25)}}function terminate(){"undefined"!=typeof applesFall&&applesFall.killAllCall(),"undefined"!=typeof apples&&apples.killAllCall(),"undefined"!=typeof apples2&&apples2.killAllCall(),"undefined"!=typeof apples3&&apples3.killAllCall(),"undefined"!=typeof obstacles&&obstacles.killAllCall()}function timing(e){let a=e+10,l=e+180,t=e+190,n=e+200,o=e+700,i=e+500,r=e+520,s=e+900,d=e+700,p=e+720,E=e+1100,T=e+1120;frameCount==e+1&&background(255),frameCount==a&&(world.setGravity([0,-9.8,30]),applesFall=new AppleSystem(0,!0)),frameCount==l&&(applesFall.killAllCall(),world.setGravity([0,-9.8,3])),frameCount==t&&(apples=new AppleSystem(1),OBSTACLESSWITCH&&(obstacles=new ObstacleSystem(OBSTACLESCOUNT))),frameCount==n&&pushers.fire(),frameCount==o&&apples.killAllCall(),frameCount==i&&(waveIndex+=1,apples2=new AppleSystem(2)),frameCount==r&&pushers.fire(),frameCount==s&&apples2.killAllCall(),frameCount==d&&(waveIndex+=1,apples3=new AppleSystem(3)),frameCount==p&&pushers.fire(),frameCount==E&&apples3.killAllCall(),frameCount==T&&(terminate(),fxpreview(),noLoop())}choosePalette();