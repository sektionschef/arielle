const MODE=1,NOISESEED=hashFnv32a(fxhash),conv=10;let canvas,rescaling_width,rescaling_height,PALETTE,PALETTE_LABEL,APPLESIZELABEL,APPLESIZE=getRandomFromList([1,1.5,2,3]);APPLESIZELABEL=APPLESIZE<2?"small":2==APPLESIZE?"medium":"large";let RESTITUTIONMin=0,RESTITUTIONMax=1,RESTITUTION=Math.round(100*getRandomFromInterval(RESTITUTIONMin,RESTITUTIONMax))/100,RESTITUTIONLabel=label_feature(RESTITUTION,RESTITUTIONMin,RESTITUTIONMax),OBSTACLESSWITCH=getRandomFromList([!0,!1]),OBSTACLESCOUNT=5,LIGHTING=getRandomFromList(["Below","Lab","Drama","Full"]);const WAVECOUNT=3,WAVEINDEXMAX=2;let waveIndex=0,INFINITY=!1,CURRENTPIXELDENS=1;const HIGHRESPIXELRATIO=4,RESBOOST=4,PALETTESYSTEM={Arielle:["#534438","#FBE1BB","#785237","#926139"],Ierissos:["#e7d3a4","#ede7d1","#404040","#7d9bb3"],Niko:["#211f1f","#808080","#c0c0c0","#ffffff"],"Fix Hellas":["#A10035","#FEC260","#3FA796","#2A0944"],Parmigiana:["#ffd1a9","#ff9e79","#fb6d4c","#c23b22","#580000"],Mamos:["#77d8f9","#624c38","#cedeed","#c64b62"],Babushka:["#d8bc00","#040c21","#74a2c6","#a43b4f"],Autodrom:["#d8bc00","#894292","#67bfee","#3e2543"],Olivenhain:["\t#14140a","#918e41","#ffc83d","#4e542c"]};function choosePalette(){allPalettes=[];for(let e in PALETTESYSTEM)allPalettes.push(e);PALETTE_LABEL=getRandomFromList(allPalettes),PALETTE=PALETTESYSTEM[PALETTE_LABEL]}function createPaletteColors(){for(let l in PALETTESYSTEM)for(var e=0;e<PALETTESYSTEM[l].length;e++)PALETTESYSTEM[l][e]=color(PALETTESYSTEM[l][e])}function preload(){const e=window.location.search,l=new URLSearchParams(e);l.has("highres")&&(CURRENTPIXELDENS=parseInt(l.get("highres"))),console.log("CURRENTPIXELDENS: "+CURRENTPIXELDENS),l.has("infinity")&&(INFINITYSTRING=l.get("infinity"),INFINITY="true"===INFINITYSTRING),console.log("INFINITY: "+INFINITY)}function setup(){noiseSeed(NOISESEED),randomSeed(NOISESEED),setAttributes("antialias",!0),scaleDynamically(),canvas=createCanvas(rescaling_width,rescaling_height,WEBGL),canvas.id("badAssCanvas"),createPaletteColors(),addTexture(),world=new OIMO.World({timestep:1/60,iterations:8,broadphase:2,worldscale:1,random:!0,info:!1,gravity:[0,-9.8,3]}),ground=new Body({type:"box",size:[100,10,100],pos:[0,-20,0],rot:[0,0,0],move:!1,density:1e3,friction:.6,restitution:0,name:"ground"},color(0,255,0,100)),lowerBorder=new Body({type:"box",size:[100,50,10],pos:[0,0,55],rot:[0,0,0],move:!1,density:1e3,friction:.2,restitution:.2,name:"lowerBorder"},color(0,155,0,100)),pushers=new PusherSystem(ground.body.shapes.width),timingInit=0}function draw(){pixelDensity(CURRENTPIXELDENS),camera(0,700,0,0,0,0,0,0,1),"Full"==LIGHTING?(ambientLight(150),directionalLight(200,200,200,1,-1,0)):"Drama"==LIGHTING?(ambientLight(50),pointLight(155,155,155,200,0,-300),pointLight(155,155,155,300,0,200),pointLight(155,155,155,450,0,-5)):"Below"==LIGHTING?(ambientLight(100),directionalLight(180,180,180,0,-1,0)):"Lab"==LIGHTING&&(ambientLight(100),directionalLight(255,255,255,0,-1,-1)),world.step(),"undefined"!=typeof applesFall&&applesFall.updateDisplay(),"undefined"!=typeof apples&&apples.updateDisplay(),"undefined"!=typeof apples2&&apples2.updateDisplay(),"undefined"!=typeof apples3&&apples3.updateDisplay(),ground.update(),lowerBorder.update(),pushers.updateDisplay(),"undefined"!=typeof obstacles&&obstacles.updateDisplay(),timing(timingInit)}function mousePressed(){}function drawPixelBuffer(e,l,a,t,i){let n=createGraphics(e,l);n.loadPixels();for(let e=0;e<n.height;e++)for(let l=0;l<n.width;l++){let s=4*(l+e*n.width);fxrand()<.02?(n.pixels[s+0]=red(t),n.pixels[s+1]=green(t),n.pixels[s+2]=blue(t)):fxrand()>.98?(n.pixels[s+0]=200,n.pixels[s+1]=200,n.pixels[s+2]=200):(n.pixels[s+0]=random(red(a)-i,red(a)+i),n.pixels[s+1]=random(green(a)-i,green(a)+i),n.pixels[s+2]=random(blue(a)-i,blue(a)+i)),n.pixels[s+3]=255}return n.updatePixels(),n}function addTexture(){for(var e=0;e<PALETTE.length;e++){if(0==e)var l=PALETTE.length-1;else l=e-1;pixelDensity(1),PALETTE[e].img=drawPixelBuffer(10*APPLESIZE*4,10*APPLESIZE*4,PALETTE[e],PALETTE[l],25),pixelDensity(CURRENTPIXELDENS)}}function terminate(){"undefined"!=typeof applesFall&&applesFall.killAllCall(),"undefined"!=typeof apples&&apples.killAllCall(),"undefined"!=typeof apples2&&apples2.killAllCall(),"undefined"!=typeof apples3&&apples3.killAllCall(),"undefined"!=typeof obstacles&&obstacles.killAllCall()}function timing(e,l=!0){let a=e+1,t=a+9,i=t+170,n=i+10,s=n+10,o=s+500,r=s+300,p=r+20,E=p+380,d=p+180,T=d+20,f=T+380,I=f+20;frameCount==a&&0==e&&background(255),frameCount==t&&0==e&&(world.setGravity([0,-9.8,30]),applesFall=new AppleSystem(0,!0)),frameCount==i&&0==e&&(applesFall.killAllCall(),world.setGravity([0,-9.8,3])),frameCount==n&&(apples=new AppleSystem(1),OBSTACLESSWITCH&&(obstacles=new ObstacleSystem(OBSTACLESCOUNT))),frameCount==s&&pushers.fire(),frameCount==o&&apples.killAllCall(),frameCount==r&&(waveIndex+=1,apples2=new AppleSystem(2)),frameCount==p&&pushers.fire(),frameCount==E&&apples2.killAllCall(),frameCount==d&&(waveIndex+=1,apples3=new AppleSystem(3)),frameCount==T&&pushers.fire(),frameCount==f&&apples3.killAllCall(),frameCount==I&&0==INFINITY?(terminate(),fxpreview(),noLoop()):frameCount==I&&1==INFINITY&&(waveIndex+=1,terminate(),timingInit=frameCount)}choosePalette();