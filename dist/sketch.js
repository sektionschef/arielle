const MODE=1,NOISESEED=hashFnv32a(fxhash);console.log("Noise seed: "+NOISESEED);let PaperDimensions={Quickie:{width:800,height:800},Stammersdorf:{width:3840,height:2160},"1to1":{width:4e3,height:4e3}};const conv=10;let scaleRatio,exportRatio,canvas,rescaling_width,rescaling_height,PALETTE,PALETTE_LABEL,exportPaper=PaperDimensions["1to1"],APPLESIZE=1,RESTITUTIONMin=0,RESTITUTIONMax=1,RESTITUTION=Math.round(100*getRandomFromInterval(RESTITUTIONMin,RESTITUTIONMax))/100,RESTITUTIONLabel=label_feature(RESTITUTION,RESTITUTIONMin,RESTITUTIONMax),OBSTACLESSWITCH=getRandomFromList([!0,!1]),OBSTACLESCOUNT=5,LIGHTING=getRandomFromList(["Below","Lab","Drama","Full"]);const WAVECOUNT=3,WAVEINDEXMAX=2;let waveIndex=0,POX1=!1;const PALETTESYSTEM={Medusa:["#534438","#FBE1BB","#785237","#926139"],Ierissos:["#e7d3a4","#ede7d1","#404040","#7d9bb3"],Niko:["#211f1f","#808080","#c0c0c0","#ffffff"],"Fix Hellas":["#A10035","#FEC260","#3FA796","#2A0944"],Lasagne:["#ffd1a9","#ff9e79","#fb6d4c","#c23b22","#580000"],Mamos:["#77d8f9","#624c38","#cedeed","#c64b62"],Babushka:["#d8bc00","#040c21","#74a2c6","#a43b4f"],Autodrom:["#d8bc00","#894292","#67bfee","#3e2543"],Olivenhain:["\t#14140a","#918e41","#ffc83d","#4e542c"]};function choosePalette(){allPalettes=[];for(let e in PALETTESYSTEM)allPalettes.push(e);PALETTE_LABEL=getRandomFromList(allPalettes),PALETTE=PALETTESYSTEM[PALETTE_LABEL]}function createPaletteColors(){for(let a in PALETTESYSTEM)for(var e=0;e<PALETTESYSTEM[a].length;e++)PALETTESYSTEM[a][e]=color(PALETTESYSTEM[a][e])}function preload(){}function setup(){noiseSeed(NOISESEED),randomSeed(NOISESEED),setAttributes("antialias",!0),scaleDynamically(),canvas=createCanvas(rescaling_width,rescaling_height,WEBGL),canvas.id("badAssCanvas"),createPaletteColors(),addTexture(),world=new OIMO.World({timestep:1/60,iterations:8,broadphase:2,worldscale:1,random:!0,info:!1,gravity:[0,-9.8,3]}),ground=new Body({type:"box",size:[100,10,100],pos:[0,-20,0],rot:[0,0,0],move:!1,density:1e3,friction:.6,restitution:0,name:"ground"},color(0,255,0,100)),lowerBorder=new Body({type:"box",size:[100,50,10],pos:[0,0,55],rot:[0,0,0],move:!1,density:1e3,friction:.2,restitution:.2,name:"lowerBorder"},color(0,155,0,100)),pushers=new PusherSystem(ground.body.shapes.width)}function draw(){camera(0,700,0,0,0,0,0,0,1),"Full"==LIGHTING?(ambientLight(150),directionalLight(200,200,200,1,-1,0)):"Drama"==LIGHTING?(ambientLight(50),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30)),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30)),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30)),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30)),pointLight(75,75,75,getRandomFromInterval(-50,50),-10,getRandomFromInterval(-30,30))):"Below"==LIGHTING?(ambientLight(100),directionalLight(180,180,180,0,-1,0)):"Lab"==LIGHTING&&(ambientLight(50),directionalLight(255,255,255,0,-1,-1)),world.step(),"undefined"!=typeof applesFall&&applesFall.updateDisplay(),"undefined"!=typeof apples&&apples.updateDisplay(),"undefined"!=typeof apples2&&apples2.updateDisplay(),"undefined"!=typeof apples3&&apples3.updateDisplay(),ground.update(),lowerBorder.update(),pushers.updateDisplay(),"undefined"!=typeof obstacles&&obstacles.updateDisplay(),timing()}function mousePressed(){console.log("frameCount; "+frameCount)}function drawPixelBuffer(e,a,l,t,o){let n=createGraphics(e,a);n.loadPixels();for(let e=0;e<n.height;e++)for(let a=0;a<n.width;a++){let i=4*(a+e*n.width);fxrand()<.02?(n.pixels[i+0]=red(t),n.pixels[i+1]=green(t),n.pixels[i+2]=blue(t)):fxrand()>.98?(n.pixels[i+0]=200,n.pixels[i+1]=200,n.pixels[i+2]=200):(n.pixels[i+0]=random(red(l)-o,red(l)+o),n.pixels[i+1]=random(green(l)-o,green(l)+o),n.pixels[i+2]=random(blue(l)-o,blue(l)+o)),n.pixels[i+3]=255}return n.updatePixels(),n}function addTexture(){for(var e=0;e<PALETTE.length;e++){if(0==e)var a=PALETTE.length-1;else a=e-1;PALETTE[e].img=drawPixelBuffer(10*APPLESIZE,10*APPLESIZE,PALETTE[e],PALETTE[a],25)}}function terminate(){console.log("Shutting down!"),applesFall.killAllCall(),apples.killAllCall(),apples2.killAllCall(),apples3.killAllCall(),console.log("Physical body count: "+world.numRigidBodies),noLoop(),fxpreview()}choosePalette();let SETUP=1,START=10,ENDFALL=180,PREWAVE1=190,WAVE1=200,WAVE1END=700,PREWAVE2=500,WAVE2=520,WAVE2END=900,PREWAVE3=700,WAVE3=720,WAVE3END=1100,END=1120;function timing(){frameCount==SETUP&&background(255),frameCount==START&&(world.setGravity([0,-9.8,30]),applesFall=new AppleSystem(100,!0)),frameCount==ENDFALL&&(console.log("Ending Fall"),applesFall.killAllCall(),world.setGravity([0,-9.8,3])),frameCount==PREWAVE1&&(console.log("Starting wave: "+waveIndex+"/2"),apples=new AppleSystem(400),OBSTACLESSWITCH&&(obstacles=new ObstacleSystem(OBSTACLESCOUNT))),frameCount==WAVE1&&(console.log("Pushers fire."),pushers.fire()),frameCount==WAVE1END&&apples.killAllCall(),frameCount==PREWAVE2&&(waveIndex+=1,console.log("Starting wave: "+waveIndex+"/2"),apples2=new AppleSystem(200)),frameCount==WAVE2&&(console.log("Pushers fire."),pushers.fire()),frameCount==WAVE2END&&apples2.killAllCall(),frameCount==PREWAVE3&&(waveIndex+=1,console.log("Starting wave: "+waveIndex+"/2"),apples3=new AppleSystem(200)),frameCount==WAVE3&&(console.log("Pushers fire."),pushers.fire()),frameCount==WAVE3END&&apples3.killAllCall(),frameCount==END&&(console.log("Safety: "+fxrand()),terminate())}