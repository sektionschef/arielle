const MODE=1,NOISESEED=hashFnv32a(fxhash);console.log("Noise seed: "+NOISESEED);let PaperDimensions={Quickie:{width:800,height:800},Stammersdorf:{width:3840,height:2160},"1to1":{width:4e3,height:4e3}};const conv=10;let scaleRatio,exportRatio,canvas,rescaling_width,rescaling_height,PALETTE,exportPaper=PaperDimensions["1to1"];const WAVECOUNT=3,WAVEINDEXMAX=2;let waveIndex=0;LIGHT="dark";let POX1=!1;function createPalette(){const e={Medusa:{apples:[color("#534438"),color("#FBE1BB"),color("#785237"),color("#926139")]},Ierissos:{apples:[color("#e7d3a4"),color("#ede7d1"),color("#404040"),color("#7d9bb3")]},Niko:{apples:[color("#211f1f"),color("#808080"),color("#c0c0c0"),color("#ffffff")]},"Fix Hellas":{apples:[color("#A10035"),color("#FEC260"),color("#3FA796"),color("#2A0944")]},Lasagne:{apples:[color("#ffd1a9"),color("#ff9e79"),color("#fb6d4c"),color("#c23b22"),color("#580000")]},Mamos:{apples:[color("#77d8f9"),color("#624c38"),color("#cedeed"),color("#c64b62")]},Babushka:{apples:[color("#d8bc00"),color("#040c21"),color("#74a2c6"),color("#a43b4f")]},Autodrom:{apples:[color("#d8bc00"),color("#894292"),color("#67bfee"),color("#3e2543")]},Olivenhain:{apples:[color("\t#14140a"),color("#918e41"),color("#ffc83d"),color("#4e542c")]}};for(var l in allPalettes=[],e)allPalettes.push(l);PALETTE=e[getRandomFromList(allPalettes)]}function preload(){}function setup(){noiseSeed(NOISESEED),randomSeed(NOISESEED),scaleDynamically(),canvas=createCanvas(rescaling_width,rescaling_height,WEBGL),canvas.id("badAssCanvas"),cam=createCamera(),createPalette(),addTexture(),world=new OIMO.World({timestep:1/60,iterations:8,broadphase:2,worldscale:1,random:!0,info:!1,gravity:[0,-9.8,3]}),ground=new Body({type:"box",size:[100,10,100],pos:[0,-20,0],rot:[0,0,0],move:!1,density:1e3,friction:.6,restitution:0,name:"ground"},color(0,255,0,100)),lowerBorder=new Body({type:"box",size:[100,50,10],pos:[0,0,55],rot:[0,0,0],move:!1,density:1e3,friction:.2,restitution:.2,name:"lowerBorder"},color(0,155,0,100)),pushers=new PusherSystem(ground.body.shapes.width),camera(0,700,0,0,0,0,0,0,1)}function draw(){"full"==LIGHT?(ambientLight(150),directionalLight(200,200,200,1,-1,0)):"dark"==LIGHT&&ambientLight(150),1==frameCount&&background(255),world.step(),"undefined"!=typeof applesFall&&applesFall.updateDisplay(),"undefined"!=typeof apples&&apples.updateDisplay(),"undefined"!=typeof apples2&&apples2.updateDisplay(),"undefined"!=typeof apples3&&apples3.updateDisplay(),ground.update(),lowerBorder.update(),pushers.updateDisplay(),"undefined"!=typeof obstacles&&obstacles.updateDisplay(),timing()}function mousePressed(){console.log("frameCount; "+frameCount)}function drawPixelBuffer(e,l,o,a){let r=createGraphics(e,l);r.loadPixels();for(let e=0;e<r.height;e++)for(let l=0;l<r.width;l++){let s=4*(l+e*r.width);fxrand()<.01?(r.pixels[s+0]=50,r.pixels[s+1]=50,r.pixels[s+2]=50):fxrand()>.99?(r.pixels[s+0]=200,r.pixels[s+1]=200,r.pixels[s+2]=200):(r.pixels[s+0]=random(red(o)-a,red(o)+a),r.pixels[s+1]=random(green(o)-a,green(o)+a),r.pixels[s+2]=random(blue(o)-a,blue(o)+a)),r.pixels[s+3]=255}return r.updatePixels(),r}function addTexture(){for(var e=0;e<PALETTE.apples.length;e++)PALETTE.apples[e].img=drawPixelBuffer(10,10,PALETTE.apples[e],20)}function terminate(){console.log("Shutting down!"),applesFall.killAllCall(),apples.killAllCall(),apples2.killAllCall(),apples3.killAllCall(),console.log("Physical body count: "+world.numRigidBodies),noLoop(),fxpreview()}let START=10,ENDFALL=180,PREWAVE1=190,WAVE1=200,WAVE1END=700,PREWAVE2=500,WAVE2=520,WAVE2END=900,PREWAVE3=700,WAVE3=720,WAVE3END=1100,END=1120;function timing(){frameCount==START&&(world.setGravity([0,-9.8,30]),applesFall=new AppleSystem(100,!0),LIGHT="dark"),frameCount==ENDFALL&&(console.log("Ending Fall"),applesFall.killAllCall(),world.setGravity([0,-9.8,3]),LIGHT="full"),frameCount==PREWAVE1&&(console.log("Starting wave: "+waveIndex+"/2"),apples=new AppleSystem(400),obstacles=new ObstacleSystem(5)),frameCount==WAVE1&&(console.log("Pushers fire."),pushers.fire()),frameCount==WAVE1END&&apples.killAllCall(),frameCount==PREWAVE2&&(waveIndex+=1,console.log("Starting wave: "+waveIndex+"/2"),apples2=new AppleSystem(200)),frameCount==WAVE2&&(console.log("Pushers fire."),pushers.fire()),frameCount==WAVE2END&&apples2.killAllCall(),frameCount==PREWAVE3&&(waveIndex+=1,console.log("Starting wave: "+waveIndex+"/2"),apples3=new AppleSystem(200)),frameCount==WAVE3&&(console.log("Pushers fire."),pushers.fire()),frameCount==WAVE3END&&apples3.killAllCall(),frameCount==END&&(console.log("Safety: "+fxrand()),terminate())}